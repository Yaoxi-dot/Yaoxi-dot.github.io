<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‹¬å¤„ç”Ÿæˆå™¨ selfcare </title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <!-- æ’’èŠ±æ•ˆæœä¿ç•™ï¼šä¸ single friendly 3.0 ç›¸åŒçš„åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        /* --- åŸºç¡€è®¾ç½® --- */
        * { box-sizing: border-box; }
        
        body {
            background-color: #FFF9F5;
            /* æµ…ç²‰è‰²æ³¢ç‚¹èƒŒæ™¯ */
            background-image: radial-gradient(#FFD1D1 2px, transparent 2px);
            background-size: 30px 30px;
            font-family: "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            margin: 0;
            padding: 40px 15px 150px 15px; /* åº•éƒ¨ç•™å¤§ç‰‡ç©ºç™½ï¼Œé˜²æ­¢åˆ°åº•éƒ¨çœ‹ä¸è§ */
            min-height: 100vh;
            color: #333;
        }

        /* é¡µé¢å±…ä¸­å®¹å™¨ */
        .container {
            max-width: 380px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- 1. æœºå™¨åŒºåŸŸ --- */
        .machine-section {
            background: #fff;
            width: 100%;
            padding: 40px 30px;
            border-radius: 30px;
            text-align: center;
            /* é˜´å½± + å½©è‰²è¾¹æ¡† */
            box-shadow: 0 10px 25px rgba(244, 166, 166, 0.35);
            border: 3px solid #F4A6A6;
            margin-bottom: 40px; /* æœºå™¨å’Œå°ç¥¨ä¹‹é—´çš„è·ç¦» */
            /* è½»å¾®ä¸Šä¸‹æŠ–åŠ¨åŠ¨ç”» */
            animation: machine-bounce 2.6s ease-in-out infinite;
        }

        @keyframes machine-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        h1 {
            color: #F4A6A6;
            font-size: 2rem;
            margin: 0 0 10px 0;
            font-weight: 800;
        }

        .subtitle {
            color: #CCC;
            font-size: 0.8rem;
            letter-spacing: 3px;
            margin-bottom: 30px;
            text-transform: uppercase;
        }

        /* è¾“å…¥æ¡† */
        .input-item { text-align: left; margin-bottom: 20px; }
        .input-label { color: #999; font-size: 0.9rem; margin-bottom: 5px; display: block; }
        
        .slot-display {
            border: 2px dashed #F8C3C3; /* ç²‰è‰²è™šçº¿ */
            border-radius: 15px;
            background: #FAFAFA;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: #555;
            font-weight: bold;
        }

        /* ç”ŸæˆæŒ‰é’® */
        .btn-generate {
            background: #F4A6A6;
            color: white;
            border: none;
            width: 100%;
            padding: 18px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            letter-spacing: 2px;
            cursor: pointer;
            box-shadow: 0 8px 15px rgba(244, 166, 166, 0.4);
            margin-top: 15px;
        }
        .btn-generate:active { background: #E09090; }

        /* --- 2. ç»“æœåŒºåŸŸ (é»˜è®¤ display: none) --- */
        .result-section {
            display: none; /* é»˜è®¤éšè— */
            width: 100%;
            flex-direction: column;
            align-items: center;
        }

        /* å°ç¥¨æ ·å¼ (é™æ€) */
        .ticket-paper {
            background: #fff;
            width: 100%;
            padding: 40px 30px 60px 30px;
            text-align: center;
            font-family: 'Courier New', Courier, monospace;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            border-radius: 0; /* å°ç¥¨æ–¹è§’ï¼Œå»æ‰é®ç½©é˜²æ­¢è¢«éšè— */
        }

        .ticket-header { font-size: 1.4rem; font-weight: 900; color: #222; margin-bottom: 10px; }
        .ticket-date { font-size: 0.85rem; color: #999; margin-bottom: 25px; }
        .ticket-line { border-top: 2px dashed #EEE; margin: 25px 0; width: 100%; }

        .ticket-row { display: flex; justify-content: space-between; margin-bottom: 20px; align-items: center; }
        .row-label { color: #BBB; font-size: 0.9rem; letter-spacing: 1px; }
        .row-val { color: #333; font-weight: bold; font-size: 1rem; }

        .ticket-quote {
            color: #F4A6A6;
            font-style: italic;
            font-weight: bold;
            font-size: 1.1rem;
            margin: 35px 0 10px 0;
            line-height: 1.4;
        }

        .barcode-wrap {
            display: flex; justify-content: center; gap: 5px; height: 40px; opacity: 0.15; margin-top: 20px;
        }
        .b-line { background: #000; width: 4px; }
        .b-thin { width: 2px; }

        /* æŒ‰é’®ç»„ */
        .btn-group { display: flex; gap: 20px; justify-content: center; }
        
        .btn-icon {
            width: 60px; height: 60px;
            border-radius: 50%;
            background: #fff;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            font-size: 1.8rem;
            color: #555;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }
        .btn-icon:hover { background: #F9F9F9; }

        /* ç™½å™ªéŸ³æ§åˆ¶æŒ‰é’® */
        .audio-ctrl {
            margin-top: 15px;
            font-size: 0.8rem;
            color: #999;
            cursor: pointer;
            background: #F5F5F5;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: background 0.3s;
        }
        .audio-ctrl:hover {
            background: #EEE;
        }

    </style>
</head>
<body>

    <div class="container">
        <div class="machine-section">
            <h1>ç‹¬å¤„ç”Ÿæˆå™¨</h1>
            <div class="subtitle">SOLO DATE GENERATOR</div>

            <div class="input-item">
                <span class="input-label">EAT ğŸ° ä»Šå¤©åƒç‚¹å¥½çš„</span>
                <div class="slot-display" id="display-food">ğŸ° å‡†å¤‡ä¸­...</div>
            </div>

            <div class="input-item">
                <span class="input-label">DO ğŸ› äº«å—ç‹¬å¤„æ—¶å…‰</span>
                <div class="slot-display" id="display-act">ğŸ› å¾…å®šä¸­...</div>
            </div>

            <button class="btn-generate" onclick="generateDate()">âœ¨ ç”Ÿæˆç‹¬å¤„è®¡åˆ’</button>

            <div class="audio-ctrl" onclick="toggleMusic()">
                <span id="music-status">ğŸ”‡</span> ç™½å™ªéŸ³ BGM
            </div>
        </div>

        <div class="result-section" id="result-area">
            
            <div class="ticket-paper" id="ticket-target">
                <div class="ticket-header">SOLO DATE TICKET</div>
                <div class="ticket-date" id="ticket-date">--.--.--</div>
                
                <div class="ticket-line"></div>
                
                <div class="ticket-row">
                    <span class="row-label">MENU</span>
                    <span class="row-val" id="res-food">...</span>
                </div>
                
                <div class="ticket-row">
                    <span class="row-label">EVENT</span>
                    <span class="row-val" id="res-act">...</span>
                </div>

                <div class="ticket-line"></div>
                
                <div class="ticket-quote" id="res-quote">...</div>

                <div class="barcode-wrap">
                    <div class="b-line"></div><div class="b-thin"></div><div class="b-line"></div>
                    <div class="b-line"></div><div class="b-thin"></div><div class="b-line"></div>
                    <div class="b-thin"></div><div class="b-line"></div><div class="b-thin"></div>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn-icon" onclick="resetAll()" title="é‡ç½®">ğŸ”„</button>
                <button class="btn-icon" onclick="downloadTicket()" title="ä¿å­˜å›¾ç‰‡">ğŸ“¥</button>
            </div>
        </div>
    </div>

    <audio id="bg-music" loop>
        <source src="https://actions.google.com/sounds/v1/weather/rain_heavy_loud.ogg" type="audio/ogg">
    </audio>

    <script>
        // æ•°æ®
        const foods = ["ğŸ° æµ·ç›èŠå£«è›‹ç³•", "ğŸ¥˜ å¯¿å–œçƒ§å°ç«é”…", "ğŸ— èœ‚èœœé»„æ²¹ç‚¸é¸¡", "ğŸœ è±šéª¨æ‹‰é¢", "ğŸ¢ ç½—æ£®å…³ä¸œç…®", "ğŸ é»‘æ¾éœ²æ„é¢", "ğŸ• æ¦´è²èŠå£«æŠ«è¨", "ğŸ¥ èˆ’èŠ™è•¾æ¾é¥¼", "ğŸ¥— è€ƒä¼¯æ²™æ‹‰"];
        const acts = ["ğŸ› æ³¡æ¾¡+é¦™è–°èœ¡çƒ›", "ğŸ§¹ æ–­èˆç¦»å¤§æ‰«é™¤", "ğŸ¬ æŠ•å½±ä»ªçœ‹è€ç”µå½±", "ğŸ§© æ‹¼å®Œ1000ç‰‡æ‹¼å›¾", "â˜ï¸ å»å…¬å›­çœ‹æ—¥è½", "ğŸ’Œ å†™ç»™æœªæ¥çš„ä¿¡", "ğŸ· ç‹¬é…Œå¾®é†º", "ğŸ“· èƒ¶ç‰‡æœºæ‰«è¡—", "ğŸ“– ç‚¹é¦™è–°è¯»å®Œä¹¦"];
        const quotes = ["â€œçˆ±è‡ªå·±æ˜¯ç»ˆèº«æµªæ¼«çš„å¼€å§‹ã€‚â€", "â€œä¸ç®¡å‡ ä¸ªäººï¼Œéƒ½è¦è®°å¾—çˆ±è‡ªå·±ã€‚â€", "â€œç‹¬å¤„æ˜¯çµé­‚çš„å‡æœŸã€‚â€", "â€œå–æ‚¦è‡ªå·±ï¼Œæ˜¯å¤´ç­‰å¤§äº‹ã€‚â€", "â€œåšè‡ªå·±çš„æœˆäº®ï¼Œä¸ä¸ºè°å‘å…‰ã€‚â€"];
        const bgMusic = document.getElementById('bg-music');

        function generateDate() {
            // 1. æ»šåŠ¨åŠ¨ç”» (è§†è§‰åé¦ˆ)
            const dFood = document.getElementById('display-food');
            const dAct = document.getElementById('display-act');
            let count = 0;
            
            // éšè—æ—§ç»“æœ
            document.getElementById('result-area').style.display = 'none';

            const timer = setInterval(() => {
                dFood.innerText = foods[Math.floor(Math.random() * foods.length)];
                dAct.innerText = acts[Math.floor(Math.random() * acts.length)];
                count++;
                
                if (count > 15) {
                    clearInterval(timer);
                    showFinalResult();
                }
            }, 50);
        }

        function showFinalResult() {
            // 2. å‡†å¤‡æ•°æ®
            const f = foods[Math.floor(Math.random() * foods.length)];
            const a = acts[Math.floor(Math.random() * acts.length)];
            const q = quotes[Math.floor(Math.random() * quotes.length)];
            const now = new Date();

            // å¡«å…¥æœºå™¨
            document.getElementById('display-food').innerText = f;
            document.getElementById('display-act').innerText = a;

            // å¡«å…¥å°ç¥¨
            document.getElementById('res-food').innerText = f;
            document.getElementById('res-act').innerText = a;
            document.getElementById('res-quote').innerText = q;
            document.getElementById('ticket-date').innerText = 
                `${now.getFullYear()}.${now.getMonth()+1}.${now.getDate()} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;

            // 3. ç›´æ¥æ˜¾ç¤ºç»“æœ (display: flex)
            const resArea = document.getElementById('result-area');
            resArea.style.display = 'flex';

            // 3.5 æ’’èŠ±æ•ˆæœ
            if (typeof confetti === 'function') {
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#FFB7B2', '#B5EAD7', '#FF9AA2', '#FFFFFF']
                });
            }

            // 4. æ»šåŠ¨åˆ°å°ç¥¨ä½ç½® (ç¡®ä¿çœ‹åˆ°å°ç¥¨)
            setTimeout(() => {
                const ticket = document.getElementById('ticket-target');
                if (ticket && typeof ticket.scrollIntoView === 'function') {
                    ticket.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        function resetAll() {
            document.getElementById('result-area').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
            setTimeout(() => {
                document.getElementById('display-food').innerText = "ğŸ° å‡†å¤‡ä¸­...";
                document.getElementById('display-act').innerText = "ğŸ› å¾…å®šä¸­...";
            }, 500);
        }

        function downloadTicket() {
            const el = document.getElementById('ticket-target');

            // ä¸‹è½½æ–¹å¼å®Œå…¨å‚è€ƒ single- friendly.html
            html2canvas(el, {
                scale: 3,
                backgroundColor: "#fff",
                useCORS: true
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'ç‹¬å¤„è®¡åˆ’å°ç¥¨.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        function toggleMusic() {
            const status = document.getElementById('music-status');
            if (bgMusic.paused) {
                bgMusic.play();
                status.innerText = "ğŸ”Š";
            } else {
                bgMusic.pause();
                status.innerText = "ğŸ”‡";
            }
        }
    </script>
</body>
</html>
